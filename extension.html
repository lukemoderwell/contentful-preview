<!doctype html>
<head>
  <link href="https://static.contentful.com/app/main-62e0abc7.css" media="all" rel="stylesheet" type="text/css">
  <link href="https://static.contentful.com/app/vendor-976872d7.css" media="all" rel="stylesheet" type="text/css">
  <link href="https://contentful.github.io/ui-extensions-sdk/cf-extension.css" media="all" rel="stylesheet" type="text/css">
  <link href="//d1tmclqz61gqwd.cloudfront.net/styles/crds-styles-3.0.6.min.css" media="all" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="https://use.typekit.net/ccb3vpa.css">
  <script type="text/javascript" src="https://unpkg.com/contentful-ui-extensions-sdk@3"></script>
  <script type="text/javascript" src="https://cdn.rawgit.com/showdownjs/showdown/1.8.6/dist/showdown.min.js"></script>
  <style>
    .preview { margin-top: 1rem; padding: 1.5rem; max-height: 30rem; overflow-y: scroll; border: 1px solid #c3cfd5; cursor: not-allowed;}
  </style>
</head>
<div data-styled-preview class="preview"></div>
<script>
  'use strict';
  
    window.contentfulExtension.init(function (extension) {
      extension.window.startAutoResizer();
      var converter = new showdown.Converter();
      var previewEl = document.querySelector('[data-styled-preview]');
      var bodyField = extension.entry.fields.body;

      bodyField.onValueChanged(handleContentChange)

      bodyField.addEventListener('input', function() {
        handleContentChange(input.value);
      })
      
      function handleContentChange(value) {
        var html = convertToHtml(value);
        previewEl.innerHTML = html;
      }

      function convertToHtml(src) {
        return converter.makeHtml(src);
      }
  })
</script>
